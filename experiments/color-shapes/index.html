<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Color Shapes</title>
	<script src="js/d3/d3.min.js"></script>
	<script src="js/util.js"></script>
	<script src="js/Vec2.js"></script>
	<script src="js/Color.js"></script>

	<style>
		canvas {
			padding: 20px;
		}
	</style>
</head>
<body>
	
	<canvas id="canvas"></canvas>


	<script>

		

		var hl = hexLines(70);

		var text = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
		var canvas = document.getElementById("canvas");
		canvas.width = 1200;
		canvas.height = 1000;
		var ctx = canvas.getContext("2d");


		var et = 0;
		var ct = Date.now();
		var pt = Date.now();
		var raf = window.requestAnimationFrame(loop);
		var r = 0;
		function loop() {
			if (r >= 256) window.cancelAnimationFrame(raf);
			else raf = window.requestAnimationFrame(loop);

			ct = Date.now();
			et += ct - pt;
			pt = ct;

			// console.log(ct + " | " + pt + " | " + et);

			if (et >= 100) {
				et = 0;
				// color = Color().r(255).g(-1).b(-1).hex();
				//r = randInt(0,255);
				color = Color(r,0,255).hex();
				console.log(color);
				resetCanvasMatrix(ctx);
				// ctx.clearRect(0,0,canvas.width,canvas.height);
				ctx.clearRect(0,0,300,300);
				ctx.beginPath();
				ctx.fillStyle = Color("#ffffff").a(0.5);
				// ctx.fillRect(0,0,canvas.width,canvas.height);
				ctx.fill();
				ctx.closePath();

				ctx.fillStyle = color;
				ctx.font="16px Helvetica";
				ctx.textBaseline = "middle"; 
				ctx.textAlign = "center"; 
				ctx.fillText(color, 250, 100);
				drawHexLegend(ctx, hl, loc);
				drawDynamicPathHex(ctx, hl, color, center);
				r++;
			}
		}



		var loc = new Vec2(100,100);

		window.addEventListener("click", function(e){
			window.cancelAnimationFrame(raf);
			// color = Color().hex();
			// console.log(color);
			// resetCanvasMatrix(ctx);
			// ctx.clearRect(0,0,canvas.width,canvas.height);
			// drawHexLegend(ctx, hl, loc);
			// drawDynamicPathHex(ctx, hl, color, center);

		})
		var center = new Vec2(canvas.width/2, canvas.height/2-100);
		var color = "#000000";
		var sub = color;
		ctx.font="16px Helvetica";
		ctx.textBaseline = "middle"; 
		ctx.textAlign = "center"; 
		ctx.fillText(sub, 250, 100);

		// drawHexLegend(ctx, hl, loc);
		// var extents = drawDynamicPathHex(ctx, hl, sub, center);

		// console.log(extents);

		function drawHexLegend(ctx, hl, location) {
			var lines = d3.range(16);
			ctx.translate(location.x, location.y);
			ctx.strokeStyle = "rgba(0,0,0,0.3)";
			ctx.fillStyle = "rgba(0,0,0,1)";
			for (var i=0; i<lines.length; i++) {
				ctx.beginPath();
				var l = hl(i);
				var b = l.begin;
				var e = l.end;
				// console.log(l.color);
				// ctx.strokeStyle = l.color;
				ctx.moveTo(b.x, b.y);
				ctx.lineTo(e.x, e.y);

				var tvec = e.clone();
				var m = tvec.mag();
				tvec = tvec.mag(m*1.2);

				ctx.textBaseline = "middle"; 
				ctx.textAlign = "center"; 
				ctx.fillText(text[i], tvec.x, tvec.y);

				ctx.stroke();
				ctx.closePath();
			}
		}

		function drawDynamicPathHex(ctx, lines, hexString, initialPoint) {
			var absPoints = [];
			var current = initialPoint.clone();

			var color = hexString.toUpperCase();
			var string = hexString.substring(1);

			absPoints.push({ x: current.x, y: current.y });

			ctx.translate(initialPoint.x, initialPoint.y);

			// var side = 10;
			// ctx.beginPath();
			// ctx.fillRect(-side/2,-side/2,side,side);
			// ctx.closePath();

			var radius = 7;

			for (var i=0; i<string.length; i++) {
				ctx.beginPath();

				var digit = string[i];
				var line = lines(digit);

				// ctx.strokeStyle = "rgba(0,0,0,0.2)";//Color(color).a(0.2).toString();
				ctx.strokeStyle = Color(color).a(0.2).toString();
				ctx.fillStyle = color;

				// ctx.arc(0,0,radius,0,2*Math.PI);

				ctx.textBaseline = "middle"; 
				ctx.textAlign = "center"; 

				

				ctx.moveTo(0,0);
				
				ctx.lineTo(line.end.x, line.end.y);

				var tvec = line.end.clone();
				var m = tvec.mag();
				tvec = tvec.mag(m * 0.5);
				// ctx.fillText(digit, tvec.x + randInt(-5,5), tvec.y + randInt(-5,5));

				ctx.translate(line.end.x, line.end.y);

				current = current.add(line.end.clone());

				absPoints.push({ x: current.x, y: current.y });



				ctx.stroke();
				ctx.fill();
				ctx.closePath();
			}

			ctx.beginPath();
			// ctx.arc(0,0,radius,0,2*Math.PI);
			ctx.fill();
			ctx.closePath();
			// side = 5;
			// ctx.beginPath();
			// ctx.fillRect(-side/2,-side/2,side,side);
			// ctx.closePath();

			var xExtent = d3.extent(absPoints.map(function(m){ return m.x; }));
			var yExtent = d3.extent(absPoints.map(function(m){ return m.y; }));

			return [xExtent, yExtent];
		}

		

		function hexLines(scale) {
			var s = undefined ? 1 : scale;
			var n = 16;
			var lines = [];
			var begin = Vec2.zero();
			var angle = 2 * Math.PI / n;
			var angleOffset = -Math.PI / 2;

			for (var i=0; i<n; i++) {
				var end = Vec2.normWithAngle(angle * i + angleOffset).mag(s);
				lines[i] = { begin: begin, end: end };
			}

			return function(i) {
				if (i >= 0 && i < n) i = i;
				else if (i === "a" || i === "A") i = 10;
				else if (i === "b" || i === "B") i = 11;
				else if (i === "c" || i === "C") i = 12;
				else if (i === "d" || i === "D") i = 13;
				else if (i === "e" || i === "E") i = 14;
				else if (i === "f" || i === "F") i = 15;
				else return null;

				return lines[i];
			};
		}


	</script>
</body>
</html>